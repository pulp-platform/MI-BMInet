Neural Network Tools for STM32 v1.2.0 (AI tools v5.0.0)
Created date       : 2020-05-26 18:04:08

Exec/report summary (validate dur=1825.487s err=0)
------------------------------------------------------------------------------------------------------------------------
model file         : /Users/tian/Documents/ETH/MLonMCU/miniproject/model_cubeai/global_class_2_ds3_nch38_T1_split_1_v1.h5
type               : keras (keras_dump)
c_name             : network
compression        : None
quantize           : None
L2r error          : 9.54719184e-08 (expected to be < 0.01)
workspace dir      : /private/var/folders/t0/z217xdqn7pl4qfh256nsf8t40000gn/T/mxAI_workspace134176402958903628637711472456561
output dir         : /Users/tian/.stm32cubemx/stm32ai_output
vinput files       : /Users/tian/Documents/ETH/MLonMCU/miniproject/data_cubeai/2class_mm_intra_xtest_split1.npy
voutput files      : /Users/tian/Documents/ETH/MLonMCU/miniproject/data_cubeai/2class_mm_intra_ytest_split1.npy

model_name         : global_class_2_ds3_nch38_T1_split_1_v1
model_hash         : 4b6ab6a08d2f7a1ad6d0702a32d048cb
input              : input_1 [2,052 items, 8.02 KiB, ai_float, FLOAT32, (38, 54, 1)]
input (total)      : 8.02 KiB
output             : softmax [2 items, 8 B, ai_float, FLOAT32, (2,)]
output (total)     : 8 B
params #           : 1,610 items (6.29 KiB)
macc               : 761,862
weights (ro)       : 6,344 (6.20 KiB) (-1.49%)
activations (rw)   : 70,272 (68.62 KiB)
ram (total)        : 78,488 (76.65 KiB) = 70,272 + 8,208 + 8

------------------------------------------------------------------------------------------------------------------------
id  layer (type)                       output shape      param #     connected to             macc           rom
------------------------------------------------------------------------------------------------------------------------
0   input_1 (Input)                    (38, 54, 1)
------------------------------------------------------------------------------------------------------------------------
1   conv2d_1 (Conv2D)                  (38, 54, 8)       344         input_1                  705,896        1,408
------------------------------------------------------------------------------------------------------------------------
2   batch_normalization_1 (ScaleBias)  (38, 54, 8)       16          conv2d_1
------------------------------------------------------------------------------------------------------------------------
3   depthwise_conv2d_1 (Conv2D)        (1, 54, 16)       608         batch_normalization_1    43,216         2,496
------------------------------------------------------------------------------------------------------------------------
4   batch_normalization_2 (ScaleBias)  (1, 54, 16)       32          depthwise_conv2d_1
------------------------------------------------------------------------------------------------------------------------
5   activation_1 (Nonlinearity)        (1, 54, 16)                   batch_normalization_2
------------------------------------------------------------------------------------------------------------------------
6   average_pooling2d_1 (Pool)         (1, 18, 16)                   activation_1
------------------------------------------------------------------------------------------------------------------------
8   separable_conv2d_1 (Conv2D)        (1, 18, 16)       256         average_pooling2d_1      4,608          1,088
    separable_conv2d_1_conv2d (Conv2D) (1, 18, 16)       256         separable_conv2d_1       8,048          1,088
------------------------------------------------------------------------------------------------------------------------
9   batch_normalization_3 (ScaleBias)  (1, 18, 16)       32          separable_conv2d_1_conv2
------------------------------------------------------------------------------------------------------------------------
10  activation_2 (Nonlinearity)        (1, 18, 16)                   batch_normalization_3
------------------------------------------------------------------------------------------------------------------------
11  average_pooling2d_2 (Pool)         (1, 2, 16)                    activation_2
------------------------------------------------------------------------------------------------------------------------
13  flatten (Reshape)                  (32,)                         average_pooling2d_2
------------------------------------------------------------------------------------------------------------------------
14  dense (Dense)                      (2,)              66          flatten                  64             264
------------------------------------------------------------------------------------------------------------------------
15  softmax (Nonlinearity)             (2,)                          dense                    30
------------------------------------------------------------------------------------------------------------------------
global_class_2_ds3_nch38_T1_split_1_v1 p=1610(6.29 KBytes) macc=761862 rom=6.20 KBytes (-1.49%) ram=68.62 KiB io_ram=8.02 KiB


Complexity/l2r error per-layer - macc=761,862 rom=6,344
------------------------------------------------------------------------------------------------------------------------
id  layer (type)                       macc                          rom                           l2r error
------------------------------------------------------------------------------------------------------------------------
1   conv2d_1 (Conv2D)                  |||||||||||||||||||||  92.7%  ||||||||||||           22.2%
3   depthwise_conv2d_1 (Conv2D)        ||                      5.7%  |||||||||||||||||||||  39.3%
8   separable_conv2d_1 (Conv2D)        |                       0.6%  |||||||||              17.2%
8   separable_conv2d_1_conv2d (Conv2D) |                       1.1%  |||||||||              17.2%
14  dense (Dense)                      |                       0.0%  |||                     4.2%
15  softmax (Nonlinearity)             |                       0.0%  |                       0.0%  9.54719184e-08 *
------------------------------------------------------------------------------------------------------------------------


ON-DEVICE STM32 execution ("network", None, 115200)..

<Stm32com id=0x1322700b8 - CONNECTED(/dev/cu.usbmodem14503/115200) devid=0x415/STM32L4x6xx msg=2.1>
 0x415/STM32L4x6xx @80MHz/80MHz (FPU is present) lat=4 ART: ICen DCen
 found network(s): ['network']
 description    : 'network' 1->[6]->1 macc=761862 rom=6.20KiB ram=68.62KiB
 tools versions : rt=(4, 1, 0) tool=(5, 0, 0)/(1, 3, 0) api=(1, 1, 0) "Tue May 26 17:33:01 2020"

Results for 1470 inference(s) @80/80MHz (macc:761862)
 device      : 0x415/STM32L4x6xx @80MHz/80MHz (FPU is present) lat=4 ART: ICen DCen
 duration    : 94.342 ms (average)
 CPU cycles  : 7547374 (average)
 cycles/MACC : 9.91 (average for all layers)
 c_nodes     : 6

Clayer  id  desc                          oshape          fmt       ms
--------------------------------------------------------------------------------
0       1   10004/(2D Convolutional)      (38, 54, 8)     float32   76.181
1       3   10011/(Merged Conv2d / Pool)  (1, 18, 16)     float32   15.580
2       8   10004/(2D Convolutional)      (1, 18, 16)     float32   0.738
3       8   10011/(Merged Conv2d / Pool)  (1, 2, 16)      float32   1.806
4       14  10005/(Dense)                 (1, 1, 2)       float32   0.019
5       15  10009/(Nonlinearity)          (1, 1, 2)       float32   0.019
                                                                    94.342 (total)


Accuracy report #1 for the generated stm32 C-model
----------------------------------------------------------------------------------------------------
NOTE: Computed against the provided ground truth values

acc=84.83%, rmse=0.3403, mae=0.2228

2 classes (1470 samples)
------------------
C0        618  117
C1        106  629

Accuracy report #1 for the reference model
----------------------------------------------------------------------------------------------------
NOTE: Computed against the provided ground truth values

acc=84.83%, rmse=0.3403, mae=0.2228

2 classes (1470 samples)
------------------
C0        618  117
C1        106  629

Cross accuracy report #1 (reference vs C-model)
----------------------------------------------------------------------------------------------------
NOTE: the output of the reference model is used as ground truth value

acc=100.00%, rmse=0.0000, mae=0.0000

2 classes (1470 samples)
------------------
C0        724   .
C1         .   746


Evaluation report (summary)
--------------------------------------------------
Mode                   acc       rmse      mae
--------------------------------------------------
stm32 C-model #1       84.8%     0.340288  0.222825
original model #1      84.8%     0.340288  0.222825
X-cross #1             100.0%    0.000000  0.000000

L2r error : 9.54719184e-08 (expected to be < 0.01)
